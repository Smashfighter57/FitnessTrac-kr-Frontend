{"ast":null,"code":"import _asyncToGenerator from\"/home/drillcode/coursework/FitTrack/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/drillcode/coursework/FitTrack/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/drillcode/coursework/FitTrack/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useEffect}from\"react\";import{useNavigate,Link}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var AccountForm=function AccountForm(_ref){var setToken=_ref.setToken,setIsLoggedIn=_ref.setIsLoggedIn,isLoggedIn=_ref.isLoggedIn;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),username=_useState2[0],setUsername=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),showCredentialsError=_useState6[0],setShowCredentialsError=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),accountError=_useState8[0],setAccountError=_useState8[1];var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),currentUser=_useState10[0],setCurrentUser=_useState10[1];var navigate=useNavigate();var _useParams=useParams(),action=_useParams.action;useEffect(function(){if(isLoggedIn)navigate('/home');},[isLoggedIn]);var fetchUserData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(auth_token){var user_data_headers,response,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;user_data_headers={'Content-Type':'application/json','Authorization':\"Bearer \".concat(auth_token)};console.log(user_data_headers);_context.next=5;return fetch(\"http://fitnesstrac-kr.herokuapp.com/api/guests/me\",{headers:user_data_headers});case 5:response=_context.sent;_context.next=8;return response.json();case 8:result=_context.sent;console.log(result);return _context.abrupt(\"return\",result);case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 16:case\"end\":return _context.stop();}}},_callee,null,[[0,13]]);}));return function fetchUserData(_x){return _ref2.apply(this,arguments);};}();var submitAccountInfo=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var response,result,auth_token,userData,errorMessage;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;event.preventDefault();_context2.next=4;return fetch(\"http://fitnesstrac-kr.herokuapp.com/api/users/\".concat(action),{method:\"POST\",headers:{'Content-Type':'application/json'},body:JSON.stringify({user:{username:username,password:password}})});case 4:response=_context2.sent;_context2.next=7;return response.json();case 7:result=_context2.sent;console.log(result);auth_token=result.data.token;setToken(auth_token);setIsLoggedIn(true);_context2.next=14;return fetchUserData(auth_token);case 14:userData=_context2.sent;setCurrentUser(userData.data.guest);setShowCredentialsError(false);navigate('/home');_context2.next=25;break;case 20:_context2.prev=20;_context2.t0=_context2[\"catch\"](0);errorMessage=action==='login'?\"Incorrect username and password combination.\":\"Username already taken.\";setAccountError(errorMessage);setShowCredentialsError(true);case 25:case\"end\":return _context2.stop();}}},_callee2,null,[[0,20]]);}));return function submitAccountInfo(_x2){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h1\",{children:action}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitAccountInfo,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{class:\"form-label\",for:\"inputUsername\",children:\"Username:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"username\",minLength:\"7\",onChange:function onChange(ev){setUsername(ev.target.value);},required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{class:\"formlabel\",for:\"inputPassword\",children:\"Password:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:\"password\",minLength:\"7\",onChange:function onChange(ev){setPassword(ev.target.value);},required:true})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Submit\"})})]}),showCredentialsError?/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:accountError}):null,action==='login'?/*#__PURE__*/_jsx(Link,{to:\"/account/register\",children:\"Don't have an account? Please Sign up here.\"}):/*#__PURE__*/_jsx(Link,{to:\"/account/login\",children:\"Already have an account? Please Login here.\"})]});};export default AccountForm;","map":{"version":3,"sources":["/home/drillcode/coursework/FitTrack/src/components/AccountForm.js"],"names":["React","useState","useEffect","useNavigate","Link","AccountForm","setToken","setIsLoggedIn","isLoggedIn","username","setUsername","password","setPassword","showCredentialsError","setShowCredentialsError","accountError","setAccountError","currentUser","setCurrentUser","navigate","useParams","action","fetchUserData","auth_token","user_data_headers","console","log","fetch","headers","response","json","result","submitAccountInfo","event","preventDefault","method","body","JSON","stringify","user","data","token","userData","guest","errorMessage","ev","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useNavigate, Link } from \"react-router-dom\";\n\nconst AccountForm = ({setToken, setIsLoggedIn, isLoggedIn}) => {\n    const [username, setUsername] = useState('')\n    const [password, setPassword] = useState('')\n    const [showCredentialsError, setShowCredentialsError] = useState(false)\n    const [accountError, setAccountError] = useState('')\n    const [currentUser, setCurrentUser] = useState({})\n    const navigate = useNavigate()\n    const {action} = useParams()\n\n    useEffect(() => {\n        if (isLoggedIn) navigate('/home')\n    }, [isLoggedIn])\n\n    const fetchUserData = async (auth_token) => {\n        try {\n            const user_data_headers = {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${auth_token}`\n            }\n            console.log(user_data_headers)\n\n            const response = await fetch(`http://fitnesstrac-kr.herokuapp.com/api/guests/me`, {\n                headers: user_data_headers\n            })\n            const result = await response.json()\n            console.log(result)\n            return result\n        }catch (error) {\n            console.log(error)\n        }\n    }\n\n    const submitAccountInfo = async (event) => {\n        try{\n            event.preventDefault();\n            const response = await fetch(`http://fitnesstrac-kr.herokuapp.com/api/users/${action}`, {\n                method: \"POST\",\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    user: {\n                    username: username,\n                    password: password\n                    }\n                })\n            })\n            const result = await response.json()\n            console.log(result)\n            const auth_token = result.data.token\n            setToken(auth_token)\n            setIsLoggedIn(true)\n            const userData = await fetchUserData(auth_token)\n            setCurrentUser(userData.data.guest)\n            setShowCredentialsError(false)\n            navigate('/home')\n        } catch(error) {\n            const errorMessage = action === 'login' ? \"Incorrect username and password combination.\" : \"Username already taken.\"\n            setAccountError (errorMessage)\n            setShowCredentialsError(true)\n        }\n    }\n\n    \n    return <>\n    <h1>{action}</h1>\n    <form onSubmit={submitAccountInfo}>\n        <div>\n            <label class=\"form-label\" for=\"inputUsername\">Username:</label>\n            <input type=\"text\" placeholder=\"username\" minLength=\"7\" onChange={(ev)=>{setUsername(ev.target.value)}} required/></div>\n        <div>\n            <label class=\"formlabel\" for=\"inputPassword\">Password:</label>\n            <input type=\"password\" placeholder=\"password\" minLength=\"7\" onChange={(ev)=>{setPassword(ev.target.value)}} required/></div>\n        <div><button type=\"submit\">Submit</button></div>\n    </form>\n    { showCredentialsError ? <div className=\"error\">{accountError}</div> : null }\n    {\n        action === 'login'\n        ? <Link to='/account/register'>Don't have an account? Please Sign up here.</Link>\n        : <Link to='/account/login'>Already have an account? Please Login here.</Link>\n    }\n    </>\n}\n\nexport default AccountForm;"]},"metadata":{},"sourceType":"module"}